import Bleed from 'nextra-theme-docs/bleed'

# Forest

Forest is an advanced state engine, targeting React but self-contained and usable in any context
in which you need structured transactional change management.

## Primary Features

* The ability to add type-aware schema to your state
* Automatic setter actions for Object/Map Properties
* Actions that can call other actions
* Actions are methods that call methods on the leaf to change values - no "definition" middleware
* Transactional scoping that ensures state reverts to pre-error status on thrown errors
* A simple construction pattern that keeps the full definition of state and change actions in the same place
* Full accessor functions to mutate Leaf structure post-creation, allowing factory functions to alter your Leaf
* Leaf instances be fully tested without instantiating their host view
* Direct integration with Immer for immutable values
* The ability to nest Leaf structures through branches and reuse construction patterns
* Designed to interoperate with RxJs: follows the observable pattern.

## A very simple example

Say you want to create a state that is a simple number, and add a few actions for utility:

```javascript

import {Leaf, isNum} from '@wonderlandlabs/forest';

const myNumber = new Leaf(0, {
  type: true, // blocks new input of a different type than the initial value
  actions: {
    increment(leaf, offset = 1) {
      leaf.next(leaf.value + offset);
    }
  }
});

myNumber.subscribe((value) => {
  console.log('... is now', value);
})

myNumber.do.increment();
myNumber.do.increment(2);
myNumber.next(5);

try {
  myNumber.next('six');
} catch (err) {
  console.log('error: ', err);
}

myNumber.next(7);

/**
* '...is now', 0
* '...is now', 1
* '...is now', 3
* '...is now', 5
* '...is now', 7
*/

```

## An Example with more fun

```javascript

import {Leaf, isNum} from '@wonderlandlabs/forest';

   function point(x, y) {
          return new Leaf({x, y}, {
            branches: {
              x: new Leaf(x, {type: true}),
              y: new Leaf(y, {type: true})
            }
          });
        }

        const box = new Leaf({
              color: 'red'
            },
            {
              branches: {
                topLeft: point(0, 0),
                bottomRight: point(1, 1)
              },
              actions: {
                width(leaf) {
                  return Math.abs(leaf.value.bottomRight.x - leaf.value.topLeft.x);
                },
                height(leaf) {
                  return Math.abs(leaf.value.topLeft.y - leaf.value.bottomRight.y);
                },
                area(leaf) {
                  return leaf.do.width() * leaf.do.height();
                }
              }
            });

        box.subscribe((value) => {
          console.log('... is now', value);
        });

        box.do.setBottomRight({x: 50, y: 50});
        console.log('box area:', box.do.area());

/**
      ... is now { color: 'red', topLeft: { x: 0, y: 0 }, bottomRight: { x: 1, y: 1 } }
      ... is now {
        color: 'red',
        topLeft: { x: 0, y: 0 },
        bottomRight: { x: 50, y: 50 }
      }
      box area: 2500
*/

```
